# Epic 5: Router Agent и Текстовый режим (MVP Feature 2)

**Цель:** Внедрить "умного" агента, который различает команды, поиск и удаление.

## Шаг 5.1: Инструменты (Tools Definition)
- [ ] В `app/services/ai_service.py` описать `TOOLS_SCHEMA` (JSON schema) согласно ТЗ (Раздел 7.2):
  - [ ] `search_contacts`
  - [ ] `delete_contact`

## Шаг 5.2: Логика Агента (Router)
- [ ] Реализовать функцию `run_router_agent(text, user_id)`.
- [ ] Вызов `client.chat.completions.create` с параметром `tools`.
- [ ] Обработка ответа LLM:
  - [ ] Если `tool_calls` нет -> вернуть текст (болтовня).
  - [ ] Если `tool_calls` есть -> распарсить, выполнить функцию сервиса, вернуть результат.

## Шаг 5.3: Текстовый хендлер
- [ ] Создать `app/handlers/text.py`.
- [ ] Перехватывать все текстовые сообщения (кроме команд).
- [ ] Вызывать `run_router_agent`.
- [ ] Если агент вернул список контактов (поиск) -> отформатировать красиво.
- [ ] Сценарий удаления:
  - [ ] Агент нашел контакты -> Бот спрашивает "Кого удалить?".
  - [ ] (Advanced) Можно реализовать через Inline кнопки или просто позволить агенту вести диалог (уточнить ID через поиск). *Для MVP 3.2 следуем ТЗ: Агент ищет, возвращает список, пользователь уточняет текстом или через UI.*

**Критерий готовности:**
- На "Привет" бот отвечает приветствием.
- На "Найди Диму" бот ищет в БД.
- На "Удали Диму" бот сначала ищет, потом (если ID найден и передан в tool) удаляет.

