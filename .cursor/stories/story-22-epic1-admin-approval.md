# Story 22: Admin Approval Tool

**Epic:** Epic 1 - The Gate (–í—Ö–æ–¥ –∏ –ö–æ–Ω—Ç—Ä–æ–ª—å)
**Parent:** .cursor/tz/epic 1 The Gate.md
**Branch:** `feature/epic1-admin-approval`
**Prerequisites:** Story 20 (Schema & Access Control)

## Context
–ü—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –æ—Ä–≥, —á—Ç–æ–±—ã –∞–ø—Ä—É–≤–∏—Ç—å –Ω–æ–≤–∏—á–∫–æ–≤. –ö–∞–º–∏–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `/admin`, –≤–∏–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫, –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ ‚Äî –ª—é–¥–∏ –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

## Technical Tasks

### 1. Admin Handler & Repository
- [x] –°–æ–∑–¥–∞—Ç—å `app/repositories/org_repo.py` (–µ—Å–ª–∏ –Ω–µ —Å–æ–∑–¥–∞–Ω –≤ Story 21):
  - –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å `organization_members` –∏ `organizations` –∏–∑ –¥—Ä—É–≥–∏—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤.
- [x] –û–±–Ω–æ–≤–∏—Ç—å `app/handlers/admin.py`:
  - –ö–æ–º–∞–Ω–¥–∞ `/admin` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π –æ—Ä–≥–∏
  - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí "–£ —Ç–µ–±—è –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"
  - –ï—Å–ª–∏ –¥–∞ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ `pending` —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–∑ –≤—Å–µ—Ö –µ–≥–æ –æ—Ä–≥

### 2. User Service Methods
- [x] –î–æ–±–∞–≤–∏—Ç—å –≤ `app/services/user_service.py`:
  - `get_pending_members(owner_id: int) -> list[dict]`:
    - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending` –∏–∑ –≤—Å–µ—Ö –æ—Ä–≥, –≥–¥–µ `owner_id = owner_id`
    - –§–æ—Ä–º–∞—Ç: `[{'user_id': int, 'org_id': str, 'org_name': str, 'username': str, 'full_name': str}, ...]`
  - `approve_member(user_id: int, org_id: str) -> bool`:
    - –û–±–Ω–æ–≤–ª—è–µ—Ç `status = 'approved'` –≤ `organization_members`
    - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `True` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ

### 3. UI (Inline Keyboard)
- [x] –§–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ —Å –∫–Ω–æ–ø–∫–∞–º–∏:
  - –§–æ—Ä–º–∞—Ç: "üë§ [–ò–º—è] (@username) ‚Äî [OrgName]"
  - –ö–Ω–æ–ø–∫–∏: `[‚úÖ –ü—Ä–∏–Ω—è—Ç—å]` –∏ `[‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å]`
  - Callback data: `approve_{user_id}_{org_id}` –∏ `reject_{user_id}_{org_id}`

### 4. Callback Handlers
- [x] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `approve_*`:
  - –í—ã–∑—ã–≤–∞–µ—Ç `user_service.approve_member()`
  - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ [OrgName]! –¢–µ–ø–µ—Ä—å —Ç–µ–±–µ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ–∏—Å–∫."
  - –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É: "‚úÖ [–ò–º—è] –ø—Ä–∏–Ω—è—Ç –≤ [OrgName]"
- [x] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `reject_*`:
  - –û–±–Ω–æ–≤–ª—è–µ—Ç `status = 'banned'` (–∏–ª–∏ —É–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å)
  - –£–≤–µ–¥–æ–º–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —Ç–≤–æ—è –∑–∞—è–≤–∫–∞ –≤ [OrgName] –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞."

## Acceptance Criteria
- [x] –ö–æ–º–∞–Ω–¥–∞ `/admin` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending` –¥–ª—è –º–æ–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
- [x] –£ –∫–∞–∂–¥–æ–≥–æ —é–∑–µ—Ä–∞ –≤ —Å–ø–∏—Å–∫–µ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ [‚úÖ –ü—Ä–∏–Ω—è—Ç—å] –∏ [‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å]
- [x] –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ [–ü—Ä–∏–Ω—è—Ç—å]: —Å—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `approved`
- [x] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ [OrgName]! –¢–µ–ø–µ—Ä—å —Ç–µ–±–µ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ–∏—Å–∫"

## Files to Change
- `app/handlers/admin.py` (–Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è pending list)
- `app/services/user_service.py` (–º–µ—Ç–æ–¥—ã `get_pending_members`, `approve_member`)

## Definition of Done
- [x] –¢–µ—Å—Ç: –í–ª–∞–¥–µ–ª–µ—Ü –æ—Ä–≥–∏ –≤–∏–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫
- [x] –¢–µ—Å—Ç: –ù–∞–∂–∞—Ç–∏–µ "–ü—Ä–∏–Ω—è—Ç—å" –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- [x] –¢–µ—Å—Ç: –ù–µ-–≤–ª–∞–¥–µ–ª–µ—Ü –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/admin`
- [x] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**Estimated:** 2.5 —á–∞—Å–∞
