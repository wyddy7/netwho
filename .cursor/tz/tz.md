# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ (–¢–ó) –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É MVP Telegram-–±–æ—Ç–∞ "NetWho"

## 1. –û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è

**–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:** NetWho (Personal CRM Bot)  
**–¢–∏–ø:** AI Agent Telegram Bot (Router Pattern)  
**–¶–µ–ª—å MVP:** –°–æ–∑–¥–∞—Ç—å "–≤—Ç–æ—Ä—É—é –ø–∞–º—è—Ç—å" –¥–ª—è –Ω–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥–∞, –∫–æ—Ç–æ—Ä–∞—è —É–º–µ–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –∏—Å–∫–∞—Ç—å, –Ω–æ –∏ –ø–æ–Ω–∏–º–∞—Ç—å –Ω–∞–º–µ—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å, –Ω–∞–π—Ç–∏, —É–¥–∞–ª–∏—Ç—å, –ø–æ–±–æ–ª—Ç–∞—Ç—å).  
**–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:** Telegram  
**–í–µ—Ä—Å–∏—è:** MVP 3.2 (Final Config)

---

## 2. –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

### 2.1. –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–µ–∫

- **–Ø–∑—ã–∫:** Python 3.12+ (—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `uv`)
- **Package Manager:** `uv` ‚Äî –º–æ–ª–Ω–∏–µ–Ω–æ—Å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- **–§—Ä–µ–π–º–≤–æ—Ä–∫:** `Aiogram 3.x` (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π, —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** **Supabase** (PostgreSQL 15+ —Å `pgvector`)
  - –ö–ª–∏–µ–Ω—Ç: `supabase-py`
- **AI –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –ß–∏—Å—Ç—ã–π `openai` SDK (async) ‚Äî –±–µ–∑ LangChain/LiteLLM.
- **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:** VPS –Ω–∞ **Timeweb Cloud** (–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –†–§, –æ–ø–ª–∞—Ç–∞ —Ä—É–±–ª—è–º–∏) + Docker.
- **–£—Ç–∏–ª–∏—Ç—ã:** `loguru` (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ) —Å —É—Ä–æ–≤–Ω–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥–µ –∏ env —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º, `pydantic-settings` (–∫–æ–Ω—Ñ–∏–≥).
  - *–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:* –°—Ç–æ—Ä–æ–Ω–Ω–∏–µ "–º–∞–≥–∏—á–µ—Å–∫–∏–µ" –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (`haolib` –∏ —Ç.–¥.) –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤ MVP, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π.

### 2.2. AI Engine (—á–µ—Ä–µ–∑ OpenRouter)

–ò—Å–ø–æ–ª—å–∑—É–µ–º **OpenRouter.ai** –∫–∞–∫ –µ–¥–∏–Ω—ã–π —à–ª—é–∑ –∫ –Ω–µ–π—Ä–æ—Å–µ—Ç—è–º (–æ–ø–ª–∞—Ç–∞ –∫—Ä–∏–ø—Ç–æ–π, —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –†–§).

- **Router / Chat LLM:** `deepseek/deepseek-chat` (V3) ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–∑–≥, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–π —Ä–µ—à–µ–Ω–∏—è (Tool Calling).
- **Fallback / Fast LLM:** `google/gemini-flash-1.5` ‚Äî –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–¥–∞—á –∏–ª–∏ –µ—Å–ª–∏ DeepSeek –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω.
- **Embeddings:** `openai/text-embedding-3-small` (—á–µ—Ä–µ–∑ OpenRouter –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é OpenAI, –µ—Å–ª–∏ –µ—Å—Ç—å –∫–ª—é—á).
- **STT (Speech-to-Text):**
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: **Groq** (whisper-large-v3-turbo) —á–µ—Ä–µ–∑ OpenRouter –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é (–±–µ—Å–ø–ª–∞—Ç–Ω–æ –∏ –±—ã—Å—Ç—Ä–æ)
  - –§–æ–ª–ª–±—ç–∫: `faster-whisper` (–ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ CPU), –µ—Å–ª–∏ –≤–Ω–µ—à–Ω–∏–µ API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã

### 2.3. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π

- **–ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:** `uv`
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `pyproject.toml` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç PEP 621)
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è:** Docker (–æ–±—Ä–∞–∑ `ghcr.io/astral-sh/uv:python3.12-bookworm-slim`)

---

## 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (Supabase)

**–í–∞–∂–Ω–æ:** –°—Ö–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ **Supabase SQL Editor**, –∞ –Ω–µ —á–µ—Ä–µ–∑ Alembic –º–∏–≥—Ä–∞—Ü–∏–∏.

### 3.1. SQL-—Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ö–µ–º—ã (Supabase SQL Editor)

```sql
-- –í–∫–ª—é—á–∞–µ–º –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –≤–∫–ª—é—á–µ–Ω–æ)
CREATE EXTENSION IF NOT EXISTS vector;

-- –¢–∞–±–ª–∏—Ü–∞ users (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
CREATE TABLE users (
  id BIGINT PRIMARY KEY,  -- Telegram ID
  username TEXT,
  full_name TEXT NOT NULL,
  is_premium BOOLEAN DEFAULT false,
  terms_accepted BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- –¢–∞–±–ª–∏—Ü–∞ contacts (–ö–æ–Ω—Ç–∞–∫—Ç—ã/–ó–∞–ø–∏—Å–∏)
CREATE TABLE contacts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  name TEXT NOT NULL,
  summary TEXT,
  raw_text TEXT,
  meta JSONB DEFAULT '{}'::jsonb,
  -- –í–ù–ò–ú–ê–ù–ò–ï: –†–∞–∑–º–µ—Ä –≤–µ–∫—Ç–æ—Ä–∞ –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ –≤ .env
  -- text-embedding-3-small = 1536
  embedding vector(1536),  
  created_at TIMESTAMPTZ DEFAULT NOW(),
  last_interaction TIMESTAMPTZ,
  reminder_at TIMESTAMPTZ,
  is_archived BOOLEAN DEFAULT false
);

-- –¢–∞–±–ª–∏—Ü–∞ interactions (–ò—Å—Ç–æ—Ä–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π)
CREATE TABLE interactions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  contact_id UUID NOT NULL REFERENCES contacts(id) ON DELETE CASCADE,
  type TEXT NOT NULL CHECK (type IN ('meeting', 'call', 'message', 'note')),
  content TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_contacts_user_id ON contacts(user_id);
CREATE INDEX idx_contacts_embedding ON contacts USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100);
CREATE INDEX idx_contacts_reminder_at ON contacts(reminder_at) WHERE reminder_at IS NOT NULL;
CREATE INDEX idx_interactions_contact_id ON interactions(contact_id);

-- RLS (Row Level Security) - –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ user_id
ALTER TABLE contacts ENABLE ROW LEVEL SECURITY;
ALTER TABLE interactions ENABLE ROW LEVEL SECURITY;

-- –ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ user_id)
CREATE POLICY "Users can only see their own contacts"
  ON contacts FOR ALL
  USING (auth.uid()::bigint = user_id);

CREATE POLICY "Users can only see their own interactions"
  ON interactions FOR ALL
  USING (
    EXISTS (
      SELECT 1 FROM contacts 
      WHERE contacts.id = interactions.contact_id 
      AND contacts.user_id = auth.uid()::bigint
    )
  );
```

### 3.2. –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü

#### –¢–∞–±–ª–∏—Ü–∞ `users` (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | BigInt (PK) | Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `username` | Text (nullable) | Username –≤ Telegram |
| `full_name` | Text | –ü–æ–ª–Ω–æ–µ –∏–º—è –∏–∑ Telegram |
| `is_premium` | Boolean | –°—Ç–∞—Ç—É—Å Premium |
| `terms_accepted` | Boolean | –°–æ–≥–ª–∞—Å–∏–µ —Å –æ—Ñ–µ—Ä—Ç–æ–π |
| `created_at` | Timestamptz | –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ |
| `updated_at` | Timestamptz | –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ |

#### –¢–∞–±–ª–∏—Ü–∞ `contacts` (–ö–æ–Ω—Ç–∞–∫—Ç—ã/–ó–∞–ø–∏—Å–∏)

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID (PK) | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∑–∞–ø–∏—Å–∏ |
| `user_id` | BigInt (FK ‚Üí users.id) | –í–ª–∞–¥–µ–ª–µ—Ü –∑–∞–ø–∏—Å–∏ |
| `name` | Text | –ò–∑–≤–ª–µ—á–µ–Ω–Ω–æ–µ –∏–º—è (–Ω–∞–ø—Ä. "–î–∏–º–∞ –ü–µ—Ç—Ä–æ–≤") |
| `summary` | Text | –ö—Ä–∞—Ç–∫–∞—è –≤—ã–∂–∏–º–∫–∞ (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Å–ø–∏—Å–∫–µ) |
| `raw_text` | Text | –ò—Å—Ö–æ–¥–Ω—ã–π —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ |
| `meta` | JSONB | –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: `{"role": "CEO", "hobbies": ["fishing"], "phones": [...]}` |
| `embedding` | Vector(1536) | –í–µ–∫—Ç–æ—Ä–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ |
| `created_at` | Timestamptz | –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞–Ω–∞ –∑–∞–ø–∏—Å—å |
| `last_interaction` | Timestamptz (nullable) | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞ |
| `reminder_at` | Timestamptz (nullable) | –î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è |
| `is_archived` | Boolean | –§–ª–∞–≥ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ (–Ω–µ —É–¥–∞–ª—è—Ç—å, –Ω–æ —Å–∫—Ä—ã–≤–∞—Ç—å) |

#### –¢–∞–±–ª–∏—Ü–∞ `interactions` (–ò—Å—Ç–æ—Ä–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π)

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID (PK) | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID |
| `contact_id` | UUID (FK ‚Üí contacts.id) | –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–Ω—Ç–∞–∫—Ç |
| `type` | Text | –¢–∏–ø: `meeting`, `call`, `message`, `note` |
| `content` | Text | –û–ø–∏—Å–∞–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è |
| `created_at` | Timestamptz | –î–∞—Ç–∞ —Å–æ–±—ã—Ç–∏—è |

### 3.3. RPC-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ (Supabase)

–î–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Å–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≤ Supabase SQL Editor:

```sql
CREATE OR REPLACE FUNCTION match_contacts(
  query_embedding vector(1536),
  match_user_id bigint,
  match_threshold float DEFAULT 0.4,
  match_count int DEFAULT 5
)
RETURNS TABLE (
  id uuid,
  name text,
  summary text,
  meta jsonb,
  distance float
)
LANGUAGE plpgsql
AS $$
BEGIN
  RETURN QUERY
  SELECT
    contacts.id,
    contacts.name,
    contacts.summary,
    contacts.meta,
    1 - (contacts.embedding <=> query_embedding) AS distance
  FROM contacts
  WHERE contacts.user_id = match_user_id
    AND contacts.is_archived = false
    AND contacts.embedding IS NOT NULL
    AND 1 - (contacts.embedding <=> query_embedding) > match_threshold
  ORDER BY contacts.embedding <=> query_embedding
  LIMIT match_count;
END;
$$;
```

---

## 4. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (MVP Features)

### 4.1. –§–∏—á–∞ 1: –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ (Voice Ingest Pipeline)

**–¢—Ä–∏–≥–≥–µ—Ä:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É.
*–ì–æ–ª–æ—Å–æ–≤—ã–µ –≤ 99% —Å–ª—É—á–∞–µ–≤ ‚Äî —ç—Ç–æ –∑–∞–º–µ—Ç–∫–∏. –ê–≥–µ–Ω—Ç —Ç—É—Ç –Ω–µ –Ω—É–∂–µ–Ω, –Ω—É–∂–µ–Ω –±—ã—Å—Ç—Ä—ã–π –ø–∞–π–ø–ª–∞–π–Ω.*

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞:**
   - –ë–æ—Ç —Å–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª `.ogg` —Å —Å–µ—Ä–≤–µ—Ä–æ–≤ Telegram (–≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–º–∞–∫—Å. 25MB –¥–ª—è Whisper API, –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–æ 20MB)

2. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∞—É–¥–∏–æ (–ö—Ä–∏—Ç–∏—á–Ω–æ!):**
   - **–í–∞–∂–Ω–æ:** –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º `.ogg` ‚Üí `.mp3` —á–µ—Ä–µ–∑ `ffmpeg` –∏–ª–∏ `pydub` –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ Whisper
   - –≠—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –Ω–∞ 10-15% (Whisper –ª—É—á—à–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å MP3)
   - –£–¥–∞–ª—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π `.ogg` –ø–æ—Å–ª–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

3. **–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è (STT):**
   - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `.mp3` —Ñ–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Whisper API (Groq –∏–ª–∏ OpenAI)
   - –ü–æ–ª—É—á–∞–µ–º `transcribed_text: str`
   - –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π `.mp3` —Ñ–∞–π–ª

4. **–ê–Ω–∞–ª–∏–∑ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π (LLM):**
   - –¢–µ–∫—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ DeepSeek V3 —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º
   - **–í–∞–∂–Ω–æ:** –ò—Å–ø–æ–ª—å–∑—É–µ–º `tenacity` –¥–ª—è Retry-–ª–æ–≥–∏–∫–∏ (DeepSeek –∏–Ω–æ–≥–¥–∞ –æ—Ç–≤–∞–ª–∏–≤–∞–µ—Ç—Å—è —Å 500 error):
     - –ü–æ–≤—Ç–æ—Ä –ø—Ä–∏ 500/502/503 –æ—à–∏–±–∫–∞—Ö
     - –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: 2 —Å–µ–∫ ‚Üí 4 —Å–µ–∫ ‚Üí 8 —Å–µ–∫
     - –ú–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏
   ```
   Extract entities from the text into JSON format:
   {
     "name": "string (required)",
     "role": "string (optional)",
     "company": "string (optional)",
     "interests": ["array of strings"],
     "hobbies": ["array of strings"],
     "contact_info": {
       "phones": ["array"],
       "emails": ["array"],
       "social": ["array"]
     },
     "needs": ["array of strings"],
     "summary": "string (–∫—Ä–∞—Ç–∫–∞—è –≤—ã–∂–∏–º–∫–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)"
   }
   ```

5. **–í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:**
   - –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç: `transcribed_text + summary` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Embedding API
   - –ü–æ–ª—É—á–∞–µ–º –≤–µ–∫—Ç–æ—Ä —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ 1536 (list of floats)

6. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (Supabase):**
   - –ò—Å–ø–æ–ª—å–∑—É–µ–º `supabase-py` –∫–ª–∏–µ–Ω—Ç:
     ```python
     supabase.table("contacts").insert({
         "user_id": user_id,
         "name": extracted_name,
         "summary": summary,
         "raw_text": transcribed_text,
         "meta": structured_meta,
         "embedding": embedding_vector
     }).execute()
     ```

7. **–û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**
   - –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: "‚úÖ –ó–∞–ø–∏—Å–∞–ª: **[–ò–º—è]** ‚Äî [–†–æ–ª—å]. –î–æ–±–∞–≤–∏–ª —Ç–µ–≥–∏: #—Ç–µ–≥1 #—Ç–µ–≥2"
   - Inline-–∫–Ω–æ–ø–∫–∞: "–î–æ–±–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- –ï—Å–ª–∏ Whisper –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–ª —Ç–µ–∫—Å—Ç ‚Üí "–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –≥–æ–ª–æ—Å. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑."
- –ï—Å–ª–∏ LLM –Ω–µ –∏–∑–≤–ª–µ–∫ –∏–º—è ‚Üí –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç" –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å raw_text
- –ï—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É –∏ —É–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 4.2. –§–∏—á–∞ 2: Router Agent & Safe Delete (Router Pattern)

**–¢—Ä–∏–≥–≥–µ—Ä:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–µ —è–≤–ª—è—é—â–µ–µ—Å—è –∫–æ–º–∞–Ω–¥–æ–π `/start`, `/help`, `/delete_me`).
–í–º–µ—Å—Ç–æ –∂–µ—Å—Ç–∫–æ–π –ª–æ–≥–∏–∫–∏ "–¢–µ–∫—Å—Ç = –ü–æ–∏—Å–∫", –º—ã –≤–Ω–µ–¥—Ä—è–µ–º **Router Agent** —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º.

**–õ–æ–≥–∏–∫–∞ (Router Pattern):**
1. –¢–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ DeepSeek V3 —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `tools` (—Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π).
2. **LLM —Ä–µ—à–∞–µ—Ç:**
   - –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –ø—Ä–æ –∫–æ–Ω—Ç–∞–∫—Ç—ã ("–ö—Ç–æ —Ç–∞–∫–æ–π –î–∏–º–∞?", "–ù–∞–π—Ç–∏ —Ä—ã–±–∞–∫–æ–≤") ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `search_contacts`.
   - –ï—Å–ª–∏ –ø—Ä–æ—Å—å–±–∞ —É–¥–∞–ª–∏—Ç—å/–∑–∞–±—ã—Ç—å ("–£–¥–∞–ª–∏ –í–∞—Å—é", "–ó–∞–±—É–¥—å –≤—Å—Ç—Ä–µ—á—É") ‚Üí –ê–≥–µ–Ω—Ç –ù–ï –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Å—Ä–∞–∑—É, —Ç–∞–∫ –∫–∞–∫ –Ω–µ –∑–Ω–∞–µ—Ç ID. –û–Ω **–æ–±—è–∑–∞–Ω** —Å–Ω–∞—á–∞–ª–∞ –≤—ã–∑–≤–∞—Ç—å `search_contacts` (–∏–ª–∏ –æ—Ç–≤–µ—Ç–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–º, —É—Ç–æ—á–Ω—è—è –∫–æ–≥–æ —É–¥–∞–ª–∏—Ç—å).
   - –ï—Å–ª–∏ –ø—Ä–æ—Å—Ç–æ –±–æ–ª—Ç–æ–≤–Ω—è ("–ü—Ä–∏–≤–µ—Ç", "–ö–∞–∫ –¥–µ–ª–∞?") ‚Üí –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç —Ç—É–ª—ã, –ø—Ä–æ—Å—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–º.

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (Tools):**

#### Tool: `search_contacts`
- **–û–ø–∏—Å–∞–Ω–∏–µ:** "Search for contacts/people/memories to find their IDs and details."
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `query` (string, required): –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è –≤–µ–∫—Ç–æ—Ä–∞.
- **–î–µ–π—Å—Ç–≤–∏–µ:**
  - –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è `query`.
  - –í—ã–∑–æ–≤ RPC-—Ñ—É–Ω–∫—Ü–∏–∏ `match_contacts` (Supabase).
  - –í–æ–∑–≤—Ä–∞—Ç —Å–ø–∏—Å–∫–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (–≤–∫–ª—é—á–∞—è **UUID**).

#### Tool: `delete_contact` (SAFE DELETE)
- **–û–ø–∏—Å–∞–Ω–∏–µ:** "Delete a contact by their UUID. YOU MUST FIND THE ID FIRST via search_contacts."
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `contact_id` (UUID, required).
- **–í–∞–∂–Ω–æ:** –ê–≥–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –≥–∞–ª–ª—é—Ü–∏–Ω–∏—Ä–æ–≤–∞—Ç—å UUID. –û–Ω –¥–æ–ª–∂–µ–Ω –≤–∑—è—Ç—å –µ–≥–æ –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–∏—Å–∫–∞.

**–°—Ü–µ–Ω–∞—Ä–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è:**
1. **–Æ–∑–µ—Ä:** "–£–¥–∞–ª–∏ –°–∞—à—É".
2. **–ê–≥–µ–Ω—Ç:**
   - –ü–æ–Ω–∏–º–∞–µ—Ç –∏–Ω—Ç–µ–Ω—Ç —É–¥–∞–ª–µ–Ω–∏—è. –ù–æ ID "–°–∞—à–∏" –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω.
   - –í—ã–∑—ã–≤–∞–µ—Ç `search_contacts("–°–∞—à–∞")`.
3. **–°–∏—Å—Ç–µ–º–∞:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤:
   - 1. –°–∞—à–∞ –ü–µ—Ç—Ä–æ–≤ (ID: uuid-1, Role: –†—ã–±–∞–∫)
   - 2. –°–∞—à–∞ –ò–≤–∞–Ω–æ–≤ (ID: uuid-2, Role: –î–∏—Ä–µ–∫—Ç–æ—Ä)
4. **–ê–≥–µ–Ω—Ç:**
   - –í–∏–¥–∏—Ç 2 –∫–æ–Ω—Ç–∞–∫—Ç–∞.
   - –û—Ç–≤–µ—á–∞–µ—Ç —é–∑–µ—Ä—É: *"–ù–∞—à–µ–ª –¥–≤—É—Ö –°–∞—à. –ö–æ–≥–æ –∏–º–µ–Ω–Ω–æ —É–¥–∞–ª–∏—Ç—å? –ü–µ—Ç—Ä–æ–≤–∞ (–†—ã–±–∞–∫) –∏–ª–∏ –ò–≤–∞–Ω–æ–≤–∞ (–î–∏—Ä–µ–∫—Ç–æ—Ä)?"*
   - (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –±–æ—Ç –º–æ–∂–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è).
5. **–Æ–∑–µ—Ä:** "–ò–≤–∞–Ω–æ–≤–∞".
6. **–ê–≥–µ–Ω—Ç:** –í—ã–∑—ã–≤–∞–µ—Ç `delete_contact(contact_id="uuid-2")`.
7. **–°–∏—Å—Ç–µ–º–∞:** –£–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å.
8. **–ê–≥–µ–Ω—Ç:** "–ö–æ–Ω—Ç–∞–∫—Ç –°–∞—à–∞ –ò–≤–∞–Ω–æ–≤ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω".

---

### 4.3. –§–∏—á–∞ 3: –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –ø–∏–Ω–æ–∫ (Active Recall / Retention)

**–¢—Ä–∏–≥–≥–µ—Ä:** –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ (APScheduler), –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ä–∞–∑ –≤ 24 —á–∞—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ 9:00 UTC).

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–í—ã–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤:**
   - –ù–∞–π—Ç–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã, –≥–¥–µ:
     - `created_at` > 7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥
     - `last_interaction` IS NULL –∏–ª–∏ `last_interaction` > 7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥
     - `is_archived = false`
     - `reminder_at` IS NULL –∏–ª–∏ `reminder_at <= NOW()`
   - –í—ã–±—Ä–∞—Ç—å 1 —Å–ª—É—á–∞–π–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç –∏–∑ –≤—ã–±–æ—Ä–∫–∏ (–∏–ª–∏ –¥–æ 3, –µ—Å–ª–∏ –∏—Ö –º–∞–ª–æ)

2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:
   ```
   üîî –ù–µ–¥–µ–ª—è –ø—Ä–æ—à–ª–∞, –∫–∞–∫ —Ç—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª **[–ò–º—è]**.
   
   –í—ã –æ–±—Å—É–∂–¥–∞–ª–∏: [Summary –∏–∑ meta]
   
   –ú–æ–∂–µ—Ç, —Å—Ç–æ–∏—Ç –Ω–∞–ø–∏—Å–∞—Ç—å?
   ```
   - Inline-–∫–Ω–æ–ø–∫–∏:
     - "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π)
     - "–û—Ç–ª–æ–∂–∏—Ç—å –Ω–∞ –Ω–µ–¥–µ–ª—é"
     - "–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å"

3. **–û—Ç–ø—Ä–∞–≤–∫–∞:**
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   - –û–±–Ω–æ–≤–∏—Ç—å `reminder_at = NOW() + INTERVAL '7 days'` (—á—Ç–æ–±—ã –Ω–µ —Å–ø–∞–º–∏—Ç—å)

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ú–∞–∫—Å–∏–º—É–º 1 –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤ –¥–µ–Ω—å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω > 30 –¥–Ω–µ–π, –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

---

## 5. –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### 5.1. `/start`
- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î (–µ—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å)
- –ü–æ–∫–∞–∑ –æ—Ñ–µ—Ä—Ç—ã (—Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö)

### 5.2. `/help`
- –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –∏ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- FAQ –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º —Å—Ü–µ–Ω–∞—Ä–∏—è–º

### 5.3. `/delete_me`
- –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î (`contacts`, `interactions`)
- –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –∏–∑ `users`
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "–î–∞, —É–¥–∞–ª–∏—Ç—å –≤—Å–µ"

### 5.4. `/list` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è MVP)
- –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
- –° –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π

---

## 6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å

### 6.1. –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –í—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã —Å—Ç—Ä–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ `user_id`
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥—Ä—É–≥–æ–º—É

### 6.2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö (–ö—Ä–∏—Ç–∏—á–Ω–æ!)

**–°–æ–ª—å –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):**
- **–í–∞–∂–Ω–æ:** –ù–µ —Ö—Ä–∞–Ω–∏—Ç—å Telegram ID –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ –≤ –ª–æ–≥–∞—Ö/–º–µ—Ç—Ä–∏–∫–∞—Ö
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `hashlib.sha256(user_id + SALT)` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
- –°–æ–ª—å —Ö—Ä–∞–Ω–∏—Ç—å –≤ `.env`: `USER_ID_SALT=your-random-salt-here`
- –≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –º–∞–ø–ø–∏–Ω–≥–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö Telegram ID –ø—Ä–∏ —É—Ç–µ—á–∫–µ –ë–î

**–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–û—Ç–º–µ–Ω–µ–Ω–æ –≤ v3.2):**
- **–ó–ê–ü–†–ï–©–ï–ù–û** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ (AES) –¥–ª—è –ø–æ–ª–µ–π `raw_text` –∏ `summary`, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã–º –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –∏ –ø–æ–∏—Å–∫ –ø–æ–¥—Å—Ç—Ä–æ–∫.
- –ü–æ–ª–∞–≥–∞–µ–º—Å—è –Ω–∞ RLS (Row Level Security) –≤ Supabase –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

### 6.3. GDPR / 152-–§–ó
- –ö–æ–º–∞–Ω–¥–∞ `/delete_me` –¥–æ–ª–∂–Ω–∞ —Ä–µ–∞–ª—å–Ω–æ —É–¥–∞–ª—è—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–∫—Ç —É–¥–∞–ª–µ–Ω–∏—è (–¥–ª—è –∞—É–¥–∏—Ç–∞)

### 6.4. –û—Ñ–µ—Ä—Ç–∞
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º `/start` –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –æ—Ñ–µ—Ä—Ç—ã:
  > "–ë–æ—Ç ‚Äî —ç—Ç–æ –≤–∞—à–∞ –ª–∏—á–Ω–∞—è –∑–∞–ø–∏—Å–Ω–∞—è –∫–Ω–∏–∂–∫–∞. –í—ã —Å–∞–º–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç–µ –¥–∞–Ω–Ω—ã–µ. –°–µ—Ä–≤–∏—Å –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö, –∞ —Ç–æ–ª—å–∫–æ —Ö—Ä–∞–Ω–∏—Ç. –ü—Ä–æ–¥–æ–ª–∂–∞—è, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è."
- –ö–Ω–æ–ø–∫–∞ "–°–æ–≥–ª–∞—Å–µ–Ω" ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–ª–∞–≥ `terms_accepted = true` –≤ `users`

---

## 7. –ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ API

### 7.1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)

```ini
# Telegram Bot
BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# Supabase (–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π Free Tier)
SUPABASE_URL=https://xyz.supabase.co
SUPABASE_KEY=ey... (anon key)

# AI –ü—Ä–æ–≤–∞–π–¥–µ—Ä (OpenRouter - –æ–ø–ª–∞—Ç–∞ –∫—Ä–∏–ø—Ç–æ–π, —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –†–§)
OPENROUTER_API_KEY=sk-or-...
OPENROUTER_BASE_URL=https://openrouter.ai/api/v1

# –ú–æ–¥–µ–ª–∏ (–º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ - Config Driven)
LLM_MODEL=deepseek/deepseek-chat
EMBEDDING_MODEL=openai/text-embedding-3-small

# Groq (–¥–ª—è STT, –µ—Å–ª–∏ –µ—Å—Ç—å –∫–ª—é—á)
GROQ_API_KEY=gsk_...

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
USER_ID_SALT=random-salt-string
LOG_LEVEL=INFO
```

### 7.2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Router Agent (`services/ai_service.py`)

```python
import json
from openai import AsyncOpenAI
from app.config import settings

# –û–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è LLM
TOOLS_SCHEMA = [
    {
        "type": "function",
        "function": {
            "name": "search_contacts",
            "description": "Search for contacts/people/memories to find their IDs and details.",
            "parameters": {
                "type": "object",
                "properties": {
                    "query": {"type": "string", "description": "Semantic search query"}
                },
                "required": ["query"]
            }
        }
    },
    {
        "type": "function",
        "function": {
            "name": "delete_contact",
            "description": "Delete a contact by their UUID. YOU MUST FIND THE ID FIRST via search_contacts.",
            "parameters": {
                "type": "object",
                "properties": {
                    "contact_id": {"type": "string", "description": "UUID of the contact to delete"}
                },
                "required": ["contact_id"]
            }
        }
    }
]

async def run_router_agent(user_text: str, user_id: int):
    """
    –ê–≥–µ–Ω—Ç-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä. –†–µ—à–∞–µ—Ç, —á—Ç–æ –¥–µ–ª–∞—Ç—å —Å —Ç–µ–∫—Å—Ç–æ–º.
    """
    client = AsyncOpenAI(
        api_key=settings.OPENROUTER_API_KEY,
        base_url=settings.OPENROUTER_BASE_URL
    )
    
    # 1. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å —Å —Ç—É–ª–∞–º–∏
    try:
        response = await client.chat.completions.create(
            model=settings.LLM_MODEL, # deepseek/deepseek-chat
            messages=[
                {"role": "system", "content": "You are a helpful CRM assistant. Determine user intent. If user asks to delete someone, you MUST search for them first to get their ID."},
                {"role": "user", "content": user_text}
            ],
            tools=TOOLS_SCHEMA,
            tool_choice="auto" 
        )
    except Exception as e:
        # Fallback –Ω–∞ –ø–æ–∏—Å–∫, –µ—Å–ª–∏ LLM —É–ø–∞–ª–∞
        return await search_service.search(user_text, user_id)

    message = response.choices[0].message

    # 2. –ï—Å–ª–∏ LLM —Ö–æ—á–µ—Ç –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é
    if message.tool_calls:
        tool_call = message.tool_calls[0] # –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤
        function_name = tool_call.function.name
        args = json.loads(tool_call.function.arguments)

        if function_name == "search_contacts":
            # –í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–∏—Å–∫ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            results = await search_service.search(args['query'], user_id)
            return format_search_results(results) # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–ª—è Telegram
        
        elif function_name == "delete_contact":
            # –í—ã–ø–æ–ª–Ω—è–µ–º —É–¥–∞–ª–µ–Ω–∏–µ
            contact_id = args.get('contact_id')
            if not contact_id:
                return "–û—à–∏–±–∫–∞: –Ω–µ —É–∫–∞–∑–∞–Ω ID –∫–æ–Ω—Ç–∞–∫—Ç–∞."
            success = await search_service.delete_by_id(contact_id, user_id)
            return f"üóë –ö–æ–Ω—Ç–∞–∫—Ç {'—É–¥–∞–ª–µ–Ω' if success else '–Ω–µ –Ω–∞–π–¥–µ–Ω'}."

    # 3. –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –±–æ–ª—Ç–æ–≤–Ω—è (–Ω–µ—Ç —Ç—É–ª–æ–≤)
    return message.content
```

### 7.3. Function Calling: Best Practices –∏ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–í–∞–∂–Ω–æ:** –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π OpenAI SDK –ø–æ–¥—Ö–æ–¥ –∫ Function Calling (Tool Calling) –¥–ª—è Router Agent.

#### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:

1. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π (Tools Schema):**
   - –ß–µ—Ç–∫–∏–µ –∏ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `strict: true` –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ (—Ç—Ä–µ–±—É–µ—Ç `additionalProperties: false` –∏ –≤—Å–µ –ø–æ–ª—è –≤ `required`)
   - –ú–∏–Ω–∏–º—É–º —Ñ—É–Ω–∫—Ü–∏–π (< 20 –¥–ª—è –ª—É—á—à–µ–π —Ç–æ—á–Ω–æ—Å—Ç–∏)

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π:**
   - –ú–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å 0, 1 –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏–π –≤ –æ–¥–Ω–æ–º –æ—Ç–≤–µ—Ç–µ
   - –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ —Å–æ–¥–µ—Ä–∂–∏—Ç `call_id`, `name`, `arguments` (JSON-—Å—Ç—Ä–æ–∫–∞)
   - –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ `function_call_output` —Å —Ç–µ–º –∂–µ `call_id`

3. **Flow –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
   ```
   1. –ó–∞–ø—Ä–æ—Å –∫ –º–æ–¥–µ–ª–∏ —Å tools
   2. –ü–æ–ª—É—á–µ–Ω–∏–µ tool_call –æ—Ç –º–æ–¥–µ–ª–∏
   3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   4. –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å –∫ –º–æ–¥–µ–ª–∏ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Ñ—É–Ω–∫—Ü–∏–∏
   5. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (–∏–ª–∏ –Ω–æ–≤—ã—Ö tool_calls)
   ```

4. **Strict Mode (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
   - –í–∫–ª—é—á–∞—Ç—å `strict: true` –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
   - –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
     - `additionalProperties: false` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –≤ `parameters`
     - –í—Å–µ –ø–æ–ª—è –≤ `properties` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ `required`
     - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è: –¥–æ–±–∞–≤–∏—Ç—å `null` –≤ `type` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"type": ["string", "null"]`)

5. **Tool Choice:**
   - `"auto"` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) ‚Äî –º–æ–¥–µ–ª—å —Ä–µ—à–∞–µ—Ç —Å–∞–º–∞
   - `"required"` ‚Äî –º–æ–¥–µ–ª—å –æ–±—è–∑–∞–Ω–∞ –≤—ã–∑–≤–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Ñ—É–Ω–∫—Ü–∏—é
   - `{"type": "function", "name": "get_weather"}` ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏

#### –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ö–µ–º—ã —Ñ—É–Ω–∫—Ü–∏–∏ (Strict Mode):

```python
{
    "type": "function",
    "name": "search_contacts",
    "description": "Search for contacts/people/memories to find their IDs and details.",
    "strict": True,
    "parameters": {
        "type": "object",
        "properties": {
            "query": {
                "type": "string",
                "description": "Semantic search query (e.g., 'who is CEO?', 'fishing lovers')"
            }
        },
        "required": ["query"],
        "additionalProperties": False
    }
}
```

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤:

```python
# –ú–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
for tool_call in response.choices[0].message.tool_calls:
    function_name = tool_call.function.name
    args = json.loads(tool_call.function.arguments)
    
    # –í—ã–ø–æ–ª–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é
    result = execute_function(function_name, args)
    
    # –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
    messages.append({
        "role": "tool",
        "tool_call_id": tool_call.id,
        "content": str(result)
    })

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞—Ç–Ω–æ –º–æ–¥–µ–ª–∏
final_response = await client.chat.completions.create(
    model=settings.LLM_MODEL,
    messages=messages,
    tools=TOOLS_SCHEMA
)
```

#### –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:

- [OpenAI Function Calling Guide](https://platform.openai.com/docs/guides/function-calling) ‚Äî –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [DeepSeek Function Calling Docs](https://api-docs.deepseek.com/guides/function_calling) ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞ DeepSeek V3
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MCP **Context7** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø—Ä–∏ –ª—é–±–æ–π –ø—Ä–æ–±–ª–µ–º–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏. 

---

## 8. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (uv + Pydantic)

```
netwho/
‚îú‚îÄ‚îÄ .cursor/
‚îÇ   ‚îî‚îÄ‚îÄ tz/
‚îÇ       ‚îî‚îÄ‚îÄ tz.md                    # –¢–ó
‚îú‚îÄ‚îÄ .env                              # –°–µ–∫—Ä–µ—Ç—ã
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ pyproject.toml                    # –ö–æ–Ω—Ñ–∏–≥ uv –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ uv.lock                           # –õ–æ–∫-—Ñ–∞–π–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ Dockerfile                        # –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥ uv
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py                       # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ config.py                     # Pydantic Settings
‚îÇ   ‚îú‚îÄ‚îÄ schemas.py                    # Pydantic –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai_service.py             # OpenRouter –∫–ª–∏–µ–Ω—Ç (Router Agent)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ audio_service.py          # OGG -> MP3
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ search_service.py         # Supabase operations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ infrastructure/
‚îÇ       ‚îî‚îÄ‚îÄ supabase/
‚îÇ           ‚îî‚îÄ‚îÄ client.py
```

### 8.1. Dockerfile (Optimized for uv)

```dockerfile
FROM ghcr.io/astral-sh/uv:python3.12-bookworm-slim

WORKDIR /app

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (ffmpeg –Ω—É–∂–µ–Ω –¥–ª—è pydub)
RUN apt-get update && apt-get install -y ffmpeg && rm -rf /var/lib/apt/lists/*

# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY pyproject.toml uv.lock ./

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–±–µ–∑ dev, –±–µ–∑ –ø—Ä–æ–µ–∫—Ç–∞)
RUN uv sync --frozen --no-dev --no-install-project

# –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–¥
COPY . .

# –ó–∞–ø—É—Å–∫
CMD ["uv", "run", "app/main.py"]
```

---

## 9. –≠—Ç–∞–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (Action Plan —Å uv)

### –≠—Ç–∞–ø 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–õ–æ–∫–∞–ª—å–Ω–æ)

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ uv:**
   ```bash
   irm https://astral.sh/uv/install.ps1 | iex  # Windows
   curl -LsSf https://astral.sh/uv/install.sh | sh # Linux/Mac
   ```
2. **–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:**
   ```bash
   uv init netwho
   cd netwho
   ```
3. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
   ```bash
   uv add aiogram supabase apscheduler openai python-dotenv pydantic-settings tenacity pydub loguru
   ```
4. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase:**
   - –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç, –≤–∫–ª—é—á–∏—Ç—å `pgvector` –≤ Extensions.
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å SQL —Å–∫—Ä–∏–ø—Ç –∏–∑ –ø.3.1.
5. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (.env):**
   - –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∫–ª—é—á–∏ OpenRouter, Supabase –∏ —Ç.–¥.

### –≠—Ç–∞–ø 2: –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

1. **–°–æ–∑–¥–∞—Ç—å `app/config.py`:** Pydantic Settings –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ `.env`.
2. **–°–æ–∑–¥–∞—Ç—å `app/schemas.py`:** –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (ContactSchema –∏ –¥—Ä.).
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–ª–∏–µ–Ω—Ç OpenAI:** –í `services/ai_service.py`.

### –≠—Ç–∞–ø 3: AI –°–µ—Ä–≤–∏—Å—ã

1. **Audio Service:** –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è OGG -> MP3.
2. **Router Agent:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `run_router_agent` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Tools (DeepSeek V3).
3. **Search Service:** –ú–µ—Ç–æ–¥—ã `search`, `delete_by_id`, `insert`.

### –≠—Ç–∞–ø 4: –•–µ–Ω–¥–ª–µ—Ä—ã (Handlers)

1. **Voice Handler:** –ü–∞–π–ø–ª–∞–π–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (STT -> LLM -> Vector -> DB).
2. **Text Handler:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è `run_router_agent`.
3. **Commands:** `/start`, `/help`, `/delete_me`.

### –≠—Ç–∞–ø 5: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

1. **Scheduler:** APScheduler –∑–∞–¥–∞—á–∞ `check_and_send_reminders`.
2. **Logic:** –í—ã–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

### –≠—Ç–∞–ø 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –î–µ–ø–ª–æ–π

1. **–†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ì–æ–ª–æ—Å–æ–≤—ã–µ, –ø–æ–∏—Å–∫, —É–¥–∞–ª–µ–Ω–∏–µ, —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∞–≥–µ–Ω—Ç–∞.
2. **Docker:** –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞.
3. **Deploy:** –ó–∞–ø—É—Å–∫ –Ω–∞ VPS (Timeweb).

---

## 10. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏ MVP

‚úÖ **–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –ë–æ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏–º—è –∫–æ–Ω—Ç–∞–∫—Ç–∞
- –ö–æ–Ω—Ç–∞–∫—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î —Å –≤–µ–∫—Ç–æ—Ä–æ–º

‚úÖ **–£–º–Ω—ã–π –∞–≥–µ–Ω—Ç (Router):**
- –ë–æ—Ç –æ—Ç–ª–∏—á–∞–µ—Ç –ø–æ–∏—Å–∫ ("–Ω–∞–π–¥–∏ –î–∏–º—É") –æ—Ç –±–æ–ª—Ç–æ–≤–Ω–∏ ("–ø—Ä–∏–≤–µ—Ç")
- –ë–æ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ (–°–Ω–∞—á–∞–ª–∞ –∏—â–µ—Ç -> –£—Ç–æ—á–Ω—è–µ—Ç -> –£–¥–∞–ª—è–µ—Ç)

‚úÖ **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:**
- –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–±—ã—Ç—ã—Ö –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏

‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –î–∞–Ω–Ω—ã–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- –ö–æ–º–∞–Ω–¥–∞ `/delete_me` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –•–∞—Ä–¥–∫–æ–¥ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –≤—Å—ë –≤ –∫–æ–Ω—Ñ–∏–≥–∞—Ö

---

## 11. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

### 11.1. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å connection pooling –¥–ª—è –ë–î (Supabase –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π pooler –Ω–∞ –ø–æ—Ä—Ç—É 6543)
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ (20MB)

### 11.2. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- –î–ª—è MVP –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–¥–Ω–æ–≥–æ –∏–Ω—Å—Ç–∞–Ω—Å–∞ –±–æ—Ç–∞

### 11.3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ API —á–µ—Ä–µ–∑ `loguru`
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤—ã—Ö, –ø–æ–∏—Å–∫–æ–≤

---

## 12. –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (Cheat Sheet)

### UV (Package Manager)
- `uv init <name>` ‚Äî —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
- `uv add <package>` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
- `uv sync` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å `uv.lock`
- `uv run <script>` ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏

### Docker
- `docker build -t netwho .` ‚Äî —Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
- `docker run -d --env-file .env --name netwho-bot netwho` ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

---

## 13. –°—Å—ã–ª–∫–∏ –∏ —Ä–µ—Å—É—Ä—Å—ã

- [UV Documentation](https://github.com/astral-sh/uv)
- [Supabase Python Client](https://github.com/supabase/supabase-py)
- [OpenRouter Docs](https://openrouter.ai/docs)
- [Timeweb Cloud](https://timeweb.cloud)
- [Pydantic Docs](https://docs.pydantic.dev/)
- [OpenAI Function Calling Guide](https://platform.openai.com/docs/guides/function-calling) ‚Äî –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ Tool Calling
- [Context7](https://context7.com) ‚Äî –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤–µ–∂–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏)

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 3.2 (Final Config)
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-01-27
**–°—Ç–∞—Ç—É—Å:** –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ. –ú–æ–∂–Ω–æ –∫–æ–¥–∏—Ç—å.
